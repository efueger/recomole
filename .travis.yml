language: python
sudo: false

env:
  - PACKAGE=recomole
  - CODECLIMATE_REPO_TOKEN=0945da156c9515dca52f7aa16b744154e0fd0965b606a89e27ed29caed55a75e

addons:
  postgresql: "9.4"

before_script:
  - ls
  - psql -a -d travis -f src/recomole/tests/data/cosim_model.sql
  - psql -a -d travis -f src/recomole/tests/data/metadata.sql
  - psql -a -d travis -f src/recomole/tests/data/relations.sql
  - psql -a -d travis -f src/recomole/tests/data/workid_meta.sql

python:
  - "3.5"

# command to install dependencies
install:
  # - pip install -r requirements.txt
  - pip install git+https://github.com/DBCDK/pytools.git
  - pip install git+https://github.com/DBCDK/pyutils.git
  - pip install pytest-cov
  - pip install codeclimate-test-reporter
  - pip install Sphinx
  - pip install -e .

# command to run tests
script:
  - pytest --cov=src/$PACKAGE
  - sphinx-apidoc --force -o docs/source/ src/$PACKAGE `pwd`/src/$PACKAGE/tests/
  - python setup.py build_sphinx --fresh-env --all-files --build-dir docs/build
  - make-build-info
  - python setup.py egg_info --tag-build=".${TRAVIS_BUILD_NUMBER}" bdist_wheel

after_success:
  - codeclimate-test-reporter
